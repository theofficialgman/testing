name: Test CI
# Controls when the workflow will run
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
jobs:
  job1:
    runs-on: ubuntu-latest
    steps:
    - name: setup QEMU
      uses: docker/setup-qemu-action@v2
    - name: Build
      run: |
        sudo docker run -i -v "${PWD}" "arm32v7/ubuntu:focal" /bin/bash -c "apt update
        DEBIAN_FRONTEND="noninteractive" TZ="Europe/London" apt-get install -y --no-install-recommends git ca-certificates build-essential libssl-dev autoconf automake libtool \
        wget vim-common desktop-file-utils pkgconf libgpgme-dev \
        libglib2.0-dev libcairo2-dev librsvg2-dev libfuse-dev git libcurl4-openssl-dev argagg-dev libgcrypt20-dev libboost-dev

        git clone https://github.com/AppImageCommunity/AppImageUpdate.git
        cd AppImageUpdate
        git checkout --recurse-submodules 2.0.0-alpha-1-20230526
        git submodule update --init --recursive
        mkdir -p build
        cd build
        cmake -DBUILD_TESTING=OFF -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_SYSTEM_NAME=Linux -DCMAKE_CXX_FLAGS=-D_FILE_OFFSET_BITS=64 -DCMAKE_C_FLAGS=-D_FILE_OFFSET_BITS=64 .. 
        make -j$(nproc)"
